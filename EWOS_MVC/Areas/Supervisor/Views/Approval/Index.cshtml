@model List<EWOS_MVC.Models.ItemRequestModel>
@{
    ViewData["Title"] = "Approval";
}
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h5 class="my-3">Waiting Approval</h5>
@if (TempData["Success"] != null)
{
    <div class="alert alert-success py-2">@TempData["Success"]</div>
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger py-2">@TempData["Error"]</div>
}

<div class="d-flex align-items-center mb-2 gap-2">
    <div class="col-2 col-sm-2">
        <select class="form-select" id="machineCategory" name="machineCategory">
            <option value="">-- Pilih Kategori --</option>
            <option value="CNC-Milling">CNC Milling</option>
            <option value="3D-Printing">3D Printing</option>
        </select>
    </div>
    <input type="text" id="searchBox" class="form-control" placeholder="Search..." aria-label="Search" style="max-width: 300px;">
</div>

<div class="container">
    <style>
        .tab-wrapper {
            max-width: auto;
            position: relative;
            border-bottom: 2px solid #dee2e6;
            margin-bottom: 1rem;
        }

        .nav-tabs {
            border: none;
            margin-bottom: 0;
        }

            .nav-tabs .nav-link {
                border: none;
                color: #6c757d;
                background-color: transparent;
                font-weight: 500;
            }

                .nav-tabs .nav-link.active {
                    color: #0d6efd;
                    border-bottom: 3px solid #0d6efd;
                    background-color: transparent;
                }

                .nav-tabs .nav-link:hover {
                    color: #0d6efd;
                }
    </style>

    <div class="tab-wrapper">
        <ul class="nav nav-tabs" id="requestTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="overview-tab" data-bs-toggle="tab" data-bs-target="#overview" type="button" role="tab">New Order</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="details-tab" data-bs-toggle="tab" data-bs-target="#details" type="button" role="tab">Repeat Order</button>
            </li>
        </ul>
    </div>


    
</div>
<table class="table table-sm table-striped table-bordered">
    <thead>
        <tr>
            <th class="text-center">No</th>
            <th>ID Request</th>
            <th>Item Name</th>
            <th>Requestor</th>
            <th>Machine Category</th>
            <th>Request Date</th>
            <th class="text-center">Action</th>
        </tr>
    </thead>
    <tbody>
        @{
            int index = 1;
        }

        @if (Model == null || !Model.Any())
        {
            <tr>
                <td colspan="12" class="text-center text-muted">Tidak ada data.</td>
            </tr>
        }
        else
        {
            foreach (var ir in Model)
            {
                <tr>
                    <td class="text-center">@index</td>
                    <td>@ir.Id</td>
                    <td>@ir.PartName</td>
                    <td>@ir.Users.Name</td>
                    <td>@ir.MachineCategories?.CategoryName</td>
                    <td>@ir.CreatedAt</td>
                    <td class="text-center">
                        <button type="button" class="btn btn-success btn-sm" data-bs-toggle="modal" data-bs-target="#modalApprove-@ir.Id">
                            Approve
                        </button>
                        <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#modalReject-@ir.Id">
                            Reject
                        </button>
                        <button type="button" class="btn btn-warning btn-sm" data-bs-toggle="modal" data-bs-target="#modalDetail-@ir.Id">
                            <i class="bi bi-info-circle"></i> Detail
                        </button>
                    </td>
                </tr>
                index++;
            }
        }
       
    </tbody>
</table>

<nav aria-label="Page navigation example">
    <ul class="pagination justify-content-end">
        <li class="page-item disabled">
            <a class="page-link">Previous</a>
        </li>
        <li class="page-item"><a class="page-link" href="#">1</a></li>
        <li class="page-item"><a class="page-link" href="#">2</a></li>
        <li class="page-item"><a class="page-link" href="#">3</a></li>
        <li class="page-item">
            <a class="page-link" href="#">Next</a>
        </li>
    </ul>
</nav>

<!-- Modal Approve -->
@if (Model != null && Model.Any())
{
    foreach (var ir in Model)
    {
        <div class="modal fade" id="modalApprove-@ir.Id" tabindex="-1" aria-labelledby="modalApprove" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="post" action="/Supervisor/Approval/Approve" enctype="multipart/form-data">
                        @Html.AntiForgeryToken()
                        <div class="modal-header bg-success">
                            <h5 class="modal-title mb-2 text-white" id="modalApprove">Approve Request</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="my-2" asp-for="ItemRequestId">Id Request</label>
                                <input class="form-control" value="@ir.Id" readonly />
                                <span asp-validation-for="PartName" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label class="my-2" asp-for="ItemRequestId">Item Name</label>
                                <input type="hidden" name="ItemRequestId" value="@ir.Id" />
                                <input name="PartName" class="form-control" value="@ir.PartName" readonly />
                                <span asp-validation-for="PartName" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-success">Approve</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

    }
}

@if (Model != null && Model.Any())
{
    foreach (var ir in Model)
    {

        <!-- Modal Reject -->
        <div class="modal fade" id="modalReject-@ir.Id" tabindex="-1" aria-labelledby="modalTambahLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <form method="post" action="/Supervisor/Approval/Reject">
                        @Html.AntiForgeryToken()

                        <div class="modal-header bg-danger">
                            <h5 class="modal-title mb-2 text-white" id="modalTambahLabel">Reject Request</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                        </div>
                        <div class="modal-body">
                            <div class="form-group">
                                <label class="my-2" asp-for="ItemRequestId">ID Request</label>
                                <input class="form-control" value="@ir.Id" readonly />
                                <span asp-validation-for="SapId" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label class="my-2" asp-for="ItemRequestId">Item Name</label>
                                <input type="hidden" name="ItemRequestId" value="@ir.Id" />
                                <input name="PartName" class="form-control" value="@ir.PartName" readonly />
                                <span asp-validation-for="SapId" class="text-danger"></span>
                            </div>
                            <div class="form-group">
                                <label class="my-2" asp-for="ItemRequestId">Reason</label>
                                <textarea class="form-control" id="Reason" name="Reason" rows="3" placeholder="Input Reason..."></textarea>
                                <span asp-validation-for="SapId" class="text-danger"></span>
                            </div>
                        </div>

                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                            <button type="submit" class="btn btn-danger">Reject</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    }
}

<!-- Modal Detail -->
@if (Model != null && Model.Any())
{
    foreach (var rm in Model)
    {
        <!-- Modal Detail -->
        <div class="modal fade" id="modalDetail-@rm.Id" tabindex="-1" aria-labelledby="detailLabel-@rm.Id" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header bg-info text-white">
                        <h5 class="modal-title" id="detailLabel-@rm.Id">Detail Data</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Tutup"></button>
                    </div>

                    <div class="modal-body">
                        <dl class="row">
                            <dt class="col-sm-4">Part Name</dt>
                            <dd class="col-sm-8">
                                @(!string.IsNullOrEmpty(rm.PartName)
                                                        ? rm.PartName
                                                        : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                                                                                                                          </dd>


                            <dt class="col-sm-4">Machine Category</dt>
                            <dd class="col-sm-8">
                                @(rm.MachineCategories.CategoryName != null
                                                        ? rm.MachineCategories.CategoryName
                                                        : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                                                                                                                          </dd>

                            <dt class="col-sm-4">External Cost ($)</dt>
                            <dd class="col-sm-8">
                                @(rm.ExternalFabCost.HasValue
                                                        ? rm.ExternalFabCost.ToString()
                                                        : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                                                                                                                          </dd>

                            <dt class="col-sm-4">Fabrication Time</dt>
                            <dd class="col-sm-8">
                                @(rm.FabricationTime.HasValue
                                                        ? rm.FabricationTime.ToString()
                                                        : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                    </dd>

                            @*         <dt class="col-sm-4">Raw Material</dt>
                                    <dd class="col-sm-8">
                                        @(rm.RawMaterials.Name != null
                                                                ? rm.RawMaterials.Name
                                                                : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                            </dd> *@

                    @if (rm.MachineCategoryId == 2)
                            {
                                <dt class="col-sm-4">Weight</dt>
                                <dd class="col-sm-8">
                                    @(rm.Weight != null
                                                            ? rm.Weight.ToString()
                                                            : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                    </dd>
                                        }

                    <dt class="col-sm-4">Part Code</dt>
                    <dd class="col-sm-8">
                        @(!string.IsNullOrEmpty(rm.PartCode)
                            ? rm.PartCode
                            : Html.Raw("<span class='text-muted fst-italic'>Belum di set</span>"))
                    </dd>
                    <dt class="col-sm-4">Quotation</dt>
                    <dd class="col-sm-8">
                        @if (!string.IsNullOrEmpty(rm.DesignPath))
                                {
                                    <a href="@Url.Content(rm.DesignPath)" target="_blank">Download</a>
                                }
                                else
                                {
                                    <span class="text-muted fst-italic">-</span>
                                }
                            </dd>

                            <dt class="col-sm-4">Link Drawing</dt>
                            <dd class="col-sm-8">
                                @if (!string.IsNullOrEmpty(rm.DrawingPath))
                                {
                                    <a href="@Url.Content(rm.DrawingPath)" target="_blank">View</a>
                                }
                                else
                                {
                                    <span class="text-muted fst-italic">-</span>
                                }
                            </dd>

                            <dt class="col-sm-4">Quotation</dt>
                            <dd class="col-sm-8">
                                @if (!string.IsNullOrEmpty(rm.QuantationPath))
                                {
                                    <a href="@Url.Content(rm.QuantationPath)" target="_blank">View</a>
                                }
                                else
                                {
                                    <span class="text-muted fst-italic">Belum di set</span>
                                }
                            </dd>

                        </dl>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    </div>
                </div>
            </div>
        </div>
    }
}
